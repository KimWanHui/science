<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì…ìì˜ ìš´ë™ê³¼ ê¸°ì²´ í™•ì‚° ì‹œë®¬ë ˆì´ì…˜ - ì¤‘1 ê³¼í•™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .achievement-box {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 14px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            padding: 30px;
        }

        .control-panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            height: fit-content;
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-group h3 {
            color: #667eea;
            font-size: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
        }

        .control-group h3::before {
            content: "ğŸ”¹";
            margin-right: 8px;
        }

        .slider-container {
            margin: 10px 0;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            color: #555;
        }

        .slider-value {
            font-weight: bold;
            color: #667eea;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .radio-option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .radio-option input[type="radio"] {
            margin-right: 10px;
        }

        .radio-option.selected {
            border-color: #667eea;
            background: #e8edff;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-start {
            background: #667eea;
            color: white;
        }

        .btn-start:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-reset {
            background: #e74c3c;
            color: white;
        }

        .btn-reset:hover {
            background: #c0392b;
        }

        .btn-compare {
            background: #3498db;
            color: white;
        }

        .btn-compare:hover {
            background: #2980b9;
        }

        .simulation-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .canvas-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        canvas {
            border: 3px solid #667eea;
            border-radius: 10px;
            display: block;
            width: 100%;
            background: linear-gradient(to bottom, #ffffff 0%, #f0f4ff 100%);
        }

        .status-bar {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .status-item {
            flex: 1;
            min-width: 150px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .status-label {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 24px;
            font-weight: bold;
        }

        .graphs-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .graph-box {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .graph-box h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .feedback-panel {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .feedback-panel h3 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .feedback-panel p {
            color: #856404;
            line-height: 1.6;
            font-size: 14px;
        }

        .quiz-panel {
            background: #d1ecf1;
            border-left: 5px solid #17a2b8;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .quiz-panel h3 {
            color: #0c5460;
            margin-bottom: 15px;
        }

        .quiz-question {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 14px;
            color: #333;
        }

        .legend {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #333;
        }

        .heatmap-legend {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .heatmap-gradient {
            width: 200px;
            height: 20px;
            background: linear-gradient(to right, 
                rgba(102, 126, 234, 0.1), 
                rgba(102, 126, 234, 0.3), 
                rgba(102, 126, 234, 0.6), 
                rgba(102, 126, 234, 0.9));
            border-radius: 10px;
        }

        .compare-mode {
            background: #d4edda;
            border-left: 5px solid #28a745;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .compare-mode.active {
            display: block;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .graphs-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª ì…ìì˜ ìš´ë™ê³¼ ê¸°ì²´ í™•ì‚° ì‹œë®¬ë ˆì´ì…˜</h1>
            <p>ì„ê³  ë°©í–¥ì œì—ì„œ í–¥ê¸°ê°€ í¼ì§€ëŠ” í˜„ìƒì„ ì…ìì˜ ìš´ë™ìœ¼ë¡œ ì´í•´í•˜ê¸°</p>
            <div class="achievement-box">
                <strong>ì„±ì·¨ê¸°ì¤€:</strong> [9ê³¼04-01] ë¬¼ì§ˆì„ ì´ë£¨ëŠ” ì…ìê°€ ìš´ë™í•˜ê³  ìˆìŒì„ í™•ì‚°, ì¦ë°œ í˜„ìƒìœ¼ë¡œ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤.
            </div>
        </div>

        <div class="main-content">
            <div class="control-panel">
                <div class="control-group">
                    <h3>ì˜¨ë„ ì„¤ì •</h3>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>ì˜¨ë„</span>
                            <span class="slider-value" id="tempValue">20Â°C (ë³´í†µ)</span>
                        </div>
                        <input type="range" id="temperature" min="0" max="40" value="20" step="10">
                    </div>
                </div>

                <div class="control-group">
                    <h3>ì…ì ìˆ˜</h3>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>ì…ì ê°œìˆ˜</span>
                            <span class="slider-value" id="particleValue">100ê°œ (ì¤‘ê°„)</span>
                        </div>
                        <input type="range" id="particleCount" min="50" max="200" value="100" step="50">
                    </div>
                </div>

                <div class="control-group">
                    <h3>ë°©í–¥ì œ ìœ„ì¹˜</h3>
                    <div class="radio-group">
                        <label class="radio-option selected">
                            <input type="radio" name="position" value="center" checked>
                            <span>ì¤‘ì•™</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="position" value="corner">
                            <span>ì™¼ìª½ êµ¬ì„</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="position" value="right">
                            <span>ì˜¤ë¥¸ìª½ ëª¨ì„œë¦¬</span>
                        </label>
                    </div>
                </div>

                <div class="control-group">
                    <h3>ê³µê°„ì˜ ë°€í ì •ë„</h3>
                    <div class="radio-group">
                        <label class="radio-option selected">
                            <input type="radio" name="closure" value="open" checked>
                            <span>ê°œë°© (ë²½ ì—†ìŒ)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="closure" value="semi">
                            <span>ë°˜ê°œë°© (ì¼ë¶€ ê°œë°©)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="closure" value="closed">
                            <span>ë°€í (ì™„ì „ ë°€í)</span>
                        </label>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn-start" onclick="startSimulation()">â–¶ ì‹œì‘</button>
                    <button class="btn-reset" onclick="resetSimulation()">ğŸ”„ ì´ˆê¸°í™”</button>
                </div>
                <button class="btn-compare" onclick="toggleCompare()" style="width: 100%; margin-top: 10px;">ğŸ“Š ë¹„êµ ëª¨ë“œ</button>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(255, 99, 132, 0.8);"></div>
                        <span>ë°©í–¥ì œ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(102, 126, 234, 0.6);"></div>
                        <span>í–¥ê¸° ì…ì</span>
                    </div>
                </div>
            </div>

            <div class="simulation-area">
                <div class="compare-mode" id="compareMode">
                    <strong>ğŸ“Š ë¹„êµ ëª¨ë“œ í™œì„±í™”:</strong> ì¡°ê±´ì„ ë³€ê²½í•˜ê³  ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì´ì „ ê²°ê³¼ì™€ ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>

                <div class="canvas-container">
                    <canvas id="simulationCanvas" width="700" height="500"></canvas>
                    <div class="status-bar">
                        <div class="status-item">
                            <div class="status-label">ê²½ê³¼ ì‹œê°„</div>
                            <div class="status-value" id="timeDisplay">0.0ì´ˆ</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">í™•ì‚° ì…ì ìˆ˜</div>
                            <div class="status-value" id="diffusedCount">0ê°œ</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">í‰ê·  í™•ì‚° ê±°ë¦¬</div>
                            <div class="status-value" id="avgDistance">0px</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">í™•ì‚° ì†ë„</div>
                            <div class="status-value" id="diffusionSpeed">0</div>
                        </div>
                    </div>

                    <div class="heatmap-legend">
                        <span style="font-size: 13px; font-weight: bold;">ì…ì ë†ë„:</span>
                        <div class="heatmap-gradient"></div>
                        <span style="font-size: 12px;">ë‚®ìŒ â†’ ë†’ìŒ</span>
                    </div>
                </div>

                <div class="graphs-container">
                    <div class="graph-box">
                        <h3>ğŸ“ˆ í™•ì‚° ë°˜ê²½ vs ì‹œê°„</h3>
                        <canvas id="radiusGraph" width="400" height="250"></canvas>
                    </div>
                    <div class="graph-box">
                        <h3>ğŸ“Š ì…ì ë†ë„ vs ê±°ë¦¬</h3>
                        <canvas id="densityGraph" width="400" height="250"></canvas>
                    </div>
                </div>

                <div class="feedback-panel" id="feedbackPanel" style="display: none;">
                    <h3>ğŸ’¡ ì‹¤í—˜ ê²°ê³¼ ë¶„ì„</h3>
                    <p id="feedbackText"></p>
                </div>

                <div class="quiz-panel">
                    <h3>ğŸ¤” ìƒê°í•´ë³¼ ë¬¸ì œ</h3>
                    <div class="quiz-question">
                        <strong>Q1.</strong> ì…ìì˜ ìˆ˜ê°€ ë§ì„ìˆ˜ë¡ í–¥ì´ ë” ë¹¨ë¦¬ í¼ì§€ëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?
                    </div>
                    <div class="quiz-question">
                        <strong>Q2.</strong> ê¸°ì˜¨ì´ ë‚®ìœ¼ë©´ í™•ì‚° ì†ë„ê°€ ëŠë ¤ì§€ëŠ” ì´ìœ ë¥¼ ì…ìì˜ ìš´ë™ìœ¼ë¡œ ì„¤ëª…í•˜ì‹œì˜¤.
                    </div>
                    <div class="quiz-question">
                        <strong>Q3.</strong> ë°©í–¥ì œë¥¼ ì¤‘ì•™ì— ë†“ì•˜ì„ ë•Œì™€ êµ¬ì„ì— ë†“ì•˜ì„ ë•Œ í™•ì‚° ì†ë„ê°€ ì–´ë–»ê²Œ ë‹¤ë¥¸ì§€ ê´€ì°°í•˜ê³ , ê·¸ ì´ìœ ë¥¼ ì„¤ëª…í•˜ì‹œì˜¤.
                    </div>
                    <div class="quiz-question">
                        <strong>Q4.</strong> í™•ì‚°ê³¼ ì¦ë°œì€ ì™œ ì…ìì˜ ìš´ë™ìœ¼ë¡œ ì„¤ëª…ë  ìˆ˜ ìˆë‚˜ìš”?
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ìº”ë²„ìŠ¤ ì„¤ì •
        const canvas = document.getElementById('simulationCanvas');
        const ctx = canvas.getContext('2d');
        const radiusCanvas = document.getElementById('radiusGraph');
        const radiusCtx = radiusCanvas.getContext('2d');
        const densityCanvas = document.getElementById('densityGraph');
        const densityCtx = densityCanvas.getContext('2d');

        // ì‹œë®¬ë ˆì´ì…˜ ë³€ìˆ˜
        let particles = [];
        let source = { x: 350, y: 250 };
        let isRunning = false;
        let animationId = null;
        let startTime = 0;
        let elapsedTime = 0;

        // ë°ì´í„° ìˆ˜ì§‘
        let radiusData = [];
        let densityData = [];
        let compareData = null;

        // ì„¤ì •ê°’
        let config = {
            temperature: 20,
            particleCount: 100,
            position: 'center',
            closure: 'open'
        };

        // ì…ì í´ë˜ìŠ¤
        class Particle {
            constructor(x, y, temp) {
                this.x = x;
                this.y = y;
                this.baseSpeed = (temp + 10) / 15; // ì˜¨ë„ì— ë”°ë¥¸ ê¸°ë³¸ ì†ë„
                this.angle = Math.random() * Math.PI * 2;
                this.speed = this.baseSpeed * (0.5 + Math.random());
                this.vx = Math.cos(this.angle) * this.speed;
                this.vy = Math.sin(this.angle) * this.speed;
                this.size = 3 + Math.random() * 2;
                this.alpha = 0.6 + Math.random() * 0.4;
                this.color = `rgba(102, 126, 234, ${this.alpha})`;
                this.trail = [];
                this.maxTrailLength = 10;
            }

            update() {
                // ë¬´ì‘ìœ„ ìš´ë™ (ë¸Œë¼ìš´ ìš´ë™)
                this.angle += (Math.random() - 0.5) * 0.3;
                this.vx = Math.cos(this.angle) * this.speed;
                this.vy = Math.sin(this.angle) * this.speed;

                // ìœ„ì¹˜ ì—…ë°ì´íŠ¸
                this.trail.push({ x: this.x, y: this.y });
                if (this.trail.length > this.maxTrailLength) {
                    this.trail.shift();
                }

                this.x += this.vx;
                this.y += this.vy;

                // ë²½ ì¶©ëŒ ì²˜ë¦¬
                if (config.closure !== 'open') {
                    if (this.x <= 10 || this.x >= canvas.width - 10) {
                        this.vx *= -0.8;
                        this.x = Math.max(10, Math.min(canvas.width - 10, this.x));
                    }
                    if (this.y <= 10 || this.y >= canvas.height - 10) {
                        this.vy *= -0.8;
                        this.y = Math.max(10, Math.min(canvas.height - 10, this.y));
                    }
                }

                // ê°œë°© ê³µê°„: í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ë°˜ëŒ€í¸ì—ì„œ ë‚˜íƒ€ë‚¨
                if (config.closure === 'open') {
                    if (this.x < 0) this.x = canvas.width;
                    if (this.x > canvas.width) this.x = 0;
                    if (this.y < 0) this.y = canvas.height;
                    if (this.y > canvas.height) this.y = 0;
                }
            }

            draw() {
                // ì…ì ê¶¤ì  ê·¸ë¦¬ê¸°
                if (this.trail.length > 1) {
                    ctx.beginPath();
                    ctx.strokeStyle = `rgba(102, 126, 234, 0.2)`;
                    ctx.lineWidth = 1;
                    ctx.moveTo(this.trail[0].x, this.trail[0].y);
                    for (let i = 1; i < this.trail.length; i++) {
                        ctx.lineTo(this.trail[i].x, this.trail[i].y);
                    }
                    ctx.stroke();
                }

                // ì…ì ê·¸ë¦¬ê¸°
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.strokeStyle = 'rgba(102, 126, 234, 0.8)';
                ctx.lineWidth = 1;
                ctx.stroke();
            }
        }

        // UI ì—…ë°ì´íŠ¸
        document.getElementById('temperature').addEventListener('input', function(e) {
            config.temperature = parseInt(e.target.value);
            let tempLabel = 'ë‚®ìŒ';
            if (config.temperature === 20) tempLabel = 'ë³´í†µ';
            if (config.temperature === 30) tempLabel = 'ë†’ìŒ';
            if (config.temperature === 40) tempLabel = 'ë§¤ìš° ë†’ìŒ';
            document.getElementById('tempValue').textContent = `${config.temperature}Â°C (${tempLabel})`;
        });

        document.getElementById('particleCount').addEventListener('input', function(e) {
            config.particleCount = parseInt(e.target.value);
            let countLabel = 'ì ìŒ';
            if (config.particleCount === 100) countLabel = 'ì¤‘ê°„';
            if (config.particleCount === 150) countLabel = 'ë§ìŒ';
            if (config.particleCount === 200) countLabel = 'ë§¤ìš° ë§ìŒ';
            document.getElementById('particleValue').textContent = `${config.particleCount}ê°œ (${countLabel})`;
        });

        document.querySelectorAll('.radio-option').forEach(option => {
            option.addEventListener('click', function() {
                const radio = this.querySelector('input[type="radio"]');
                radio.checked = true;
                
                this.parentElement.querySelectorAll('.radio-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');

                if (radio.name === 'position') {
                    config.position = radio.value;
                } else if (radio.name === 'closure') {
                    config.closure = radio.value;
                }
            });
        });

        // ë°©í–¥ì œ ìœ„ì¹˜ ì„¤ì •
        function setSourcePosition() {
            switch(config.position) {
                case 'center':
                    source = { x: canvas.width / 2, y: canvas.height / 2 };
                    break;
                case 'corner':
                    source = { x: 50, y: 50 };
                    break;
                case 'right':
                    source = { x: canvas.width - 50, y: canvas.height / 2 };
                    break;
            }
        }

        // ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘
        function startSimulation() {
            if (isRunning) return;

            // ë¹„êµ ëª¨ë“œ: í˜„ì¬ ë°ì´í„° ì €ì¥
            if (document.getElementById('compareMode').classList.contains('active')) {
                compareData = {
                    radiusData: [...radiusData],
                    config: {...config}
                };
            }

            resetSimulation();
            isRunning = true;
            startTime = Date.now();
            setSourcePosition();

            // ì…ì ìƒì„±
            for (let i = 0; i < config.particleCount; i++) {
                setTimeout(() => {
                    particles.push(new Particle(source.x, source.y, config.temperature));
                }, i * 50); // ìˆœì°¨ì ìœ¼ë¡œ ìƒì„±
            }

            animate();
        }

        // ì‹œë®¬ë ˆì´ì…˜ ì´ˆê¸°í™”
        function resetSimulation() {
            isRunning = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            particles = [];
            radiusData = [];
            densityData = [];
            elapsedTime = 0;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();
            
            document.getElementById('timeDisplay').textContent = '0.0ì´ˆ';
            document.getElementById('diffusedCount').textContent = '0ê°œ';
            document.getElementById('avgDistance').textContent = '0px';
            document.getElementById('diffusionSpeed').textContent = '0';
            document.getElementById('feedbackPanel').style.display = 'none';
        }

        // ë°°ê²½ ê·¸ë¦¬ê¸°
        function drawBackground() {
            // ë°°ê²½ ê·¸ë¼ë””ì–¸íŠ¸
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#ffffff');
            gradient.addColorStop(1, '#f0f4ff');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // íˆíŠ¸ë§µ ê·¸ë¦¬ê¸°
            drawHeatmap();

            // ë°©í–¥ì œ ê·¸ë¦¬ê¸°
            ctx.beginPath();
            ctx.arc(source.x, source.y, 20, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(255, 99, 132, 0.8)';
            ctx.fill();
            ctx.strokeStyle = 'rgba(255, 99, 132, 1)';
            ctx.lineWidth = 3;
            ctx.stroke();

            // ë°©í–¥ì œ ë¼ë²¨
            ctx.fillStyle = '#333';
            ctx.font = 'bold 12px Malgun Gothic';
            ctx.textAlign = 'center';
            ctx.fillText('ë°©í–¥ì œ', source.x, source.y + 35);

            // ë²½ ê·¸ë¦¬ê¸° (ë°€í ìƒíƒœ)
            if (config.closure === 'closed') {
                ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.lineWidth = 8;
                ctx.strokeRect(5, 5, canvas.width - 10, canvas.height - 10);
            } else if (config.closure === 'semi') {
                ctx.strokeStyle = 'rgba(0, 0, 0, 0.2)';
                ctx.lineWidth = 5;
                ctx.setLineDash([15, 15]);
                ctx.strokeRect(5, 5, canvas.width - 10, canvas.height - 10);
                ctx.setLineDash([]);
            }
        }

        // íˆíŠ¸ë§µ ê·¸ë¦¬ê¸°
        function drawHeatmap() {
            const gridSize = 40;
            const cols = Math.ceil(canvas.width / gridSize);
            const rows = Math.ceil(canvas.height / gridSize);
            
            for (let i = 0; i < cols; i++) {
                for (let j = 0; j < rows; j++) {
                    const x = i * gridSize;
                    const y = j * gridSize;
                    const centerX = x + gridSize / 2;
                    const centerY = y + gridSize / 2;
                    
                    // í•´ë‹¹ ì˜ì—­ì˜ ì…ì ìˆ˜ ê³„ì‚°
                    let count = 0;
                    particles.forEach(p => {
                        if (p.x >= x && p.x < x + gridSize && p.y >= y && p.y < y + gridSize) {
                            count++;
                        }
                    });
                    
                    // ë†ë„ì— ë”°ë¥¸ ìƒ‰ìƒ
                    const maxCount = 20;
                    const intensity = Math.min(count / maxCount, 1);
                    ctx.fillStyle = `rgba(102, 126, 234, ${intensity * 0.15})`;
                    ctx.fillRect(x, y, gridSize, gridSize);
                }
            }
        }

        // ì• ë‹ˆë©”ì´ì…˜
        function animate() {
            if (!isRunning) return;

            elapsedTime = (Date.now() - startTime) / 1000;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();

            // ì…ì ì—…ë°ì´íŠ¸ ë° ê·¸ë¦¬ê¸°
            particles.forEach(p => {
                p.update();
                p.draw();
            });

            // í†µê³„ ê³„ì‚°
            let totalDistance = 0;
            let maxDistance = 0;
            particles.forEach(p => {
                const dist = Math.sqrt(Math.pow(p.x - source.x, 2) + Math.pow(p.y - source.y, 2));
                totalDistance += dist;
                maxDistance = Math.max(maxDistance, dist);
            });

            const avgDistance = particles.length > 0 ? totalDistance / particles.length : 0;
            const diffusionSpeed = particles.length > 0 ? (avgDistance / elapsedTime).toFixed(1) : 0;

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('timeDisplay').textContent = elapsedTime.toFixed(1) + 'ì´ˆ';
            document.getElementById('diffusedCount').textContent = particles.length + 'ê°œ';
            document.getElementById('avgDistance').textContent = Math.round(avgDistance) + 'px';
            document.getElementById('diffusionSpeed').textContent = diffusionSpeed;

            // ë°ì´í„° ìˆ˜ì§‘ (0.5ì´ˆë§ˆë‹¤)
            if (elapsedTime % 0.5 < 0.05) {
                radiusData.push({ time: elapsedTime, radius: avgDistance });
                updateGraphs();
            }

            // í”¼ë“œë°± ìƒì„± (5ì´ˆ í›„)
            if (elapsedTime > 5 && document.getElementById('feedbackPanel').style.display === 'none') {
                generateFeedback();
            }

            animationId = requestAnimationFrame(animate);
        }

        // ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
        function updateGraphs() {
            // í™•ì‚° ë°˜ê²½ ê·¸ë˜í”„
            radiusCtx.clearRect(0, 0, radiusCanvas.width, radiusCanvas.height);
            
            // ê·¸ë¦¬ë“œ
            radiusCtx.strokeStyle = '#e0e0e0';
            radiusCtx.lineWidth = 1;
            for (let i = 0; i < 5; i++) {
                const y = radiusCanvas.height - (i * radiusCanvas.height / 4);
                radiusCtx.beginPath();
                radiusCtx.moveTo(0, y);
                radiusCtx.lineTo(radiusCanvas.width, y);
                radiusCtx.stroke();
            }

            // ì¶• ë¼ë²¨
            radiusCtx.fillStyle = '#666';
            radiusCtx.font = '10px Malgun Gothic';
            radiusCtx.textAlign = 'left';
            radiusCtx.fillText('ì‹œê°„(ì´ˆ)', 10, 15);
            radiusCtx.save();
            radiusCtx.translate(15, radiusCanvas.height / 2);
            radiusCtx.rotate(-Math.PI / 2);
            radiusCtx.fillText('í™•ì‚° ë°˜ê²½(px)', 0, 0);
            radiusCtx.restore();

            if (radiusData.length > 1) {
                const maxTime = Math.max(...radiusData.map(d => d.time));
                const maxRadius = Math.max(...radiusData.map(d => d.radius));

                // í˜„ì¬ ë°ì´í„° ê·¸ë¦¬ê¸°
                radiusCtx.beginPath();
                radiusCtx.strokeStyle = '#667eea';
                radiusCtx.lineWidth = 3;
                radiusData.forEach((d, i) => {
                    const x = (d.time / maxTime) * radiusCanvas.width;
                    const y = radiusCanvas.height - (d.radius / maxRadius) * radiusCanvas.height;
                    if (i === 0) {
                        radiusCtx.moveTo(x, y);
                    } else {
                        radiusCtx.lineTo(x, y);
                    }
                });
                radiusCtx.stroke();

                // ë¹„êµ ë°ì´í„° ê·¸ë¦¬ê¸°
                if (compareData && compareData.radiusData.length > 1) {
                    radiusCtx.beginPath();
                    radiusCtx.strokeStyle = '#ff6384';
                    radiusCtx.lineWidth = 2;
                    radiusCtx.setLineDash([5, 5]);
                    compareData.radiusData.forEach((d, i) => {
                        const x = (d.time / maxTime) * radiusCanvas.width;
                        const y = radiusCanvas.height - (d.radius / maxRadius) * radiusCanvas.height;
                        if (i === 0) {
                            radiusCtx.moveTo(x, y);
                        } else {
                            radiusCtx.lineTo(x, y);
                        }
                    });
                    radiusCtx.stroke();
                    radiusCtx.setLineDash([]);
                }
            }

            // ì…ì ë†ë„ ê·¸ë˜í”„
            densityCtx.clearRect(0, 0, densityCanvas.width, densityCanvas.height);
            
            // ê·¸ë¦¬ë“œ
            densityCtx.strokeStyle = '#e0e0e0';
            densityCtx.lineWidth = 1;
            for (let i = 0; i < 5; i++) {
                const y = densityCanvas.height - (i * densityCanvas.height / 4);
                densityCtx.beginPath();
                densityCtx.moveTo(0, y);
                densityCtx.lineTo(densityCanvas.width, y);
                densityCtx.stroke();
            }

            // ì¶• ë¼ë²¨
            densityCtx.fillStyle = '#666';
            densityCtx.font = '10px Malgun Gothic';
            densityCtx.textAlign = 'left';
            densityCtx.fillText('ê±°ë¦¬(px)', 10, 15);
            densityCtx.save();
            densityCtx.translate(15, densityCanvas.height / 2);
            densityCtx.rotate(-Math.PI / 2);
            densityCtx.fillText('ì…ì ë†ë„', 0, 0);
            densityCtx.restore();

            // ê±°ë¦¬ë³„ ì…ì ìˆ˜ ê³„ì‚°
            const bins = 10;
            const maxDist = Math.max(canvas.width, canvas.height) / 2;
            const binSize = maxDist / bins;
            const densityCounts = new Array(bins).fill(0);

            particles.forEach(p => {
                const dist = Math.sqrt(Math.pow(p.x - source.x, 2) + Math.pow(p.y - source.y, 2));
                const binIndex = Math.min(Math.floor(dist / binSize), bins - 1);
                densityCounts[binIndex]++;
            });

            // ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
            const maxCount = Math.max(...densityCounts, 1);
            const barWidth = densityCanvas.width / bins;
            
            densityCounts.forEach((count, i) => {
                const height = (count / maxCount) * densityCanvas.height * 0.8;
                const x = i * barWidth;
                const y = densityCanvas.height - height;
                
                const gradient = densityCtx.createLinearGradient(0, y, 0, densityCanvas.height);
                gradient.addColorStop(0, 'rgba(102, 126, 234, 0.8)');
                gradient.addColorStop(1, 'rgba(102, 126, 234, 0.4)');
                
                densityCtx.fillStyle = gradient;
                densityCtx.fillRect(x + 2, y, barWidth - 4, height);
                
                densityCtx.strokeStyle = '#667eea';
                densityCtx.lineWidth = 1;
                densityCtx.strokeRect(x + 2, y, barWidth - 4, height);
            });
        }

        // í”¼ë“œë°± ìƒì„±
        function generateFeedback() {
            const feedbackPanel = document.getElementById('feedbackPanel');
            const feedbackText = document.getElementById('feedbackText');
            
            let feedback = `<strong>ì‹¤í—˜ ì¡°ê±´:</strong> ì˜¨ë„ ${config.temperature}Â°C, ì…ì ${config.particleCount}ê°œ, ìœ„ì¹˜: ${getPositionText()}<br><br>`;
            
            feedback += `<strong>ê´€ì°° ê²°ê³¼:</strong><br>`;
            
            if (config.temperature >= 30) {
                feedback += `â€¢ ë†’ì€ ì˜¨ë„ì—ì„œ ì…ìì˜ í‰ê·  ìš´ë™ ì†ë„ê°€ ì¦ê°€í•˜ì—¬ í™•ì‚°ì´ ë¹ ë¥´ê²Œ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì˜¨ë„ê°€ ë†’ì„ìˆ˜ë¡ ì…ìì˜ ìš´ë™ ì—ë„ˆì§€ê°€ ì»¤ì§€ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.<br>`;
            } else if (config.temperature <= 10) {
                feedback += `â€¢ ë‚®ì€ ì˜¨ë„ì—ì„œ ì…ìì˜ ìš´ë™ ì†ë„ê°€ ëŠë ¤ í™•ì‚°ì´ ì²œì²œíˆ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤. ì˜¨ë„ê°€ ë‚®ìœ¼ë©´ ì…ìì˜ ìš´ë™ ì—ë„ˆì§€ê°€ ì‘ì•„ì§‘ë‹ˆë‹¤.<br>`;
            }
            
            if (config.particleCount >= 150) {
                feedback += `â€¢ ì…ì ìˆ˜ê°€ ë§ì•„ ì „ì²´ì ì¸ í™•ì‚° ë²”ìœ„ê°€ ë„“ê³ , ê³µê°„ ì „ì²´ì— ë¹ ë¥´ê²Œ í¼ì¡ŒìŠµë‹ˆë‹¤.<br>`;
            }
            
            if (config.position === 'center') {
                feedback += `â€¢ ë°©í–¥ì œë¥¼ ì¤‘ì•™ì— ë°°ì¹˜í•˜ì—¬ ëª¨ë“  ë°©í–¥ìœ¼ë¡œ ê· ë“±í•˜ê²Œ í™•ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤.<br>`;
            } else {
                feedback += `â€¢ ë°©í–¥ì œë¥¼ í•œìª½ì— ë°°ì¹˜í•˜ì—¬ í™•ì‚°ì´ ë¹„ëŒ€ì¹­ì ìœ¼ë¡œ ì§„í–‰ë˜ì—ˆìœ¼ë©°, ë¨¼ ê³³ê¹Œì§€ ë„ë‹¬í•˜ëŠ”ë° ë” ë§ì€ ì‹œê°„ì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤.<br>`;
            }

            feedback += `<br><strong>ğŸ’¡ í•µì‹¬ ê°œë…:</strong> í™•ì‚°ì€ ì…ìë“¤ì˜ ìë°œì ì´ê³  ë¬´ì‘ìœ„ì ì¸ ìš´ë™(ë¸Œë¼ìš´ ìš´ë™)ì˜ ê²°ê³¼ì…ë‹ˆë‹¤. ì…ìë“¤ì€ ëŠì„ì—†ì´ ì›€ì§ì´ë©°, ì´ ìš´ë™ìœ¼ë¡œ ì¸í•´ ë†ë„ê°€ ë†’ì€ ê³³ì—ì„œ ë‚®ì€ ê³³ìœ¼ë¡œ ë¬¼ì§ˆì´ ì´ë™í•©ë‹ˆë‹¤.`;
            
            feedbackText.innerHTML = feedback;
            feedbackPanel.style.display = 'block';
        }

        function getPositionText() {
            switch(config.position) {
                case 'center': return 'ì¤‘ì•™';
                case 'corner': return 'ì™¼ìª½ êµ¬ì„';
                case 'right': return 'ì˜¤ë¥¸ìª½ ëª¨ì„œë¦¬';
                default: return 'ì¤‘ì•™';
            }
        }

        // ë¹„êµ ëª¨ë“œ í† ê¸€
        function toggleCompare() {
            const compareMode = document.getElementById('compareMode');
            compareMode.classList.toggle('active');
        }

        // ì´ˆê¸°í™”
        drawBackground();
    </script>
</body>
</html>
